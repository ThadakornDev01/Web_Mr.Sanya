<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Corporate Meeting Room Booking</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500&display=swap"
      rel="stylesheet"
    />

    <style>
      /* --- 1. Global & Main Layout --- */
      :root {
        --primary: #4f46e5;
        --primary-hover: #4338ca;
        --success: #10b981;
        --danger: #ef4444;
        --text-main: #1e293b;
        --bg-body: #f1f5f9;
        --card-bg: #ffffff;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body {
        font-family: "Kanit", sans-serif;
        background-color: var(--bg-body);
        color: var(--text-main);
        margin: 0;
        padding: 40px 20px;
      }

      .container {
        max-width: 1100px;
        margin: 0 auto;
      }
      header {
        text-align: center;
        margin-bottom: 50px;
      }
      header h1 {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 10px;
      }

      .room-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
      }

      .room-card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 30px;
        min-height: 320px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .room-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .room-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 8px;
      }
      .room-card.available::before {
        background-color: var(--success);
      }
      .room-card.busy::before {
        background-color: var(--danger);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        padding: 5px 14px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-bottom: 20px;
        width: fit-content;
      }
      .available .badge {
        background: #d1fae5;
        color: #065f46;
      }
      .busy .badge {
        background: #fee2e2;
        color: #991b1b;
      }

      button {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        font-family: "Kanit", sans-serif;
        margin-top: auto;
      }
      .btn-book {
        background: var(--primary);
        color: white;
      }
      .btn-book:hover {
        background: var(--primary-hover);
      }
      .btn-cancel {
        background: white;
        color: var(--danger);
        border: 1px solid var(--danger);
      }
      .btn-cancel:hover {
        background: var(--danger);
        color: white;
      }

      .info-box {
        background: #f8fafc;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid var(--danger);
        font-size: 0.9rem;
      }

      /* --- 2. Modal Styles --- */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        backdrop-filter: blur(4px);
      }

      .modal-box {
        background: white;
        padding: 25px;
        border-radius: 20px;
        width: 90%;
        max-width: 420px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        animation: slideIn 0.3s ease-out;
        max-height: 90vh;
        overflow-y: auto;
      }

      @keyframes slideIn {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        margin-bottom: 15px;
        text-align: center;
      }
      .modal-header h2 {
        margin: 0;
        color: var(--primary);
      }
      .modal-header p {
        margin: 5px 0 0;
        color: #64748b;
        font-size: 0.9rem;
      }

      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #334155;
      }
      .form-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        font-family: "Kanit", sans-serif;
        box-sizing: border-box;
      }

      /* Styles for Time Range Inputs */
      .time-range-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .time-select {
        flex: 1;
        padding: 12px;
        border: 1px solid #cbd5e1;
        border-radius: 8px;
        font-family: "Kanit", sans-serif;
        background-color: white;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23334155' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 10px center;
        background-size: 16px;
      }

      .time-range-group span {
        color: #64748b;
        font-size: 0.9rem;
        white-space: nowrap;
      }

      /* --- 3. CUSTOM CALENDAR STYLES --- */
      .calendar-wrapper {
        background-color: #ffffff;
        color: var(--text-main);
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 15px;
        border: 1px solid #e2e8f0;
      }

      .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        font-size: 1.1rem;
        font-weight: 500;
        color: var(--primary);
      }

      .cal-nav-btn {
  width: 36px;
  height: 36px;
  padding: 0;
  border-radius: 50%;      /* ‚Üê ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° */
  display: flex;
  align-items: center;
  justify-content: center;

  background: none;
  border: none;
  color: #64748b;
  cursor: pointer;
  font-size: 1.2rem;
  transition: all 0.2s ease;
}

.cal-nav-btn:hover {
  background-color: #f1f5f9;
  color: var(--primary);
}


      .calendar-days-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        text-align: center;
        margin-bottom: 10px;
        font-size: 0.85rem;
        color: #64748b;
        font-weight: 500;
      }

      .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        text-align: center;
      }

      .cal-date {
        padding: 10px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        font-size: 0.95rem;
        color: var(--text-main);
      }

      .cal-date:hover:not(.disabled):not(.selected) {
        background-color: #f1f5f9;
        color: var(--primary);
      }

      .cal-date.selected {
        background-color: var(--primary);
        color: white;
        font-weight: bold;
        box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.4);
      }

      .cal-date.disabled {
        color: #cbd5e1;
        cursor: not-allowed;
        background-color: transparent;
      }

      .cal-date.today {
        border: 1px solid var(--primary);
        color: var(--primary);
        font-weight: 600;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }
      .btn-confirm {
        background: var(--primary);
        color: white;
      }
      .btn-close {
        background: #e2e8f0;
        color: #475569;
      }

      /* ===== History Section ===== */
      .history-section {
        margin-top: 50px;
      }

      .history-title {
        font-size: 1.4rem;
        color: #2563eb;
        margin-bottom: 15px;
      }

      /* ===== Table Wrapper ===== */
      .table-wrapper {
        overflow-x: auto;
        background: #ffffff;
        border-radius: 14px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      }

      /* ===== Table ===== */
      .history-table {
        width: 100%;
        border-collapse: collapse;
        min-width: 700px;
      }

      /* ===== Header ===== */
      .history-table thead {
        background: linear-gradient(135deg, #e0e7ff, #f8fafc);
      }

      .history-table th {
        padding: 14px 12px;
        text-align: center;
        font-weight: 600;
        color: #1e3a8a;
        border-bottom: 2px solid #c7d2fe;
      }

      /* ===== Body ===== */
      .history-table td {
        padding: 12px;
        text-align: center;
        color: #334155;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.95rem;
      }

      /* ===== Hover ===== */
      .history-table tbody tr:hover {
        background: #f1f5ff;
        transition: 0.2s;
      }

      /* ===== Last Row ===== */
      .history-table tbody tr:last-child td {
        border-bottom: none;
      }
      /* ===== Mini Floating Admin Button ===== */
      .admin-fab {
        position: fixed;
        bottom: 22px;
        right: 22px;
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: none;
        background: #1e40af;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;

        display: flex;
        align-items: center;
        justify-content: center;

        box-shadow: 0 8px 20px rgba(30, 64, 175, 0.35);
        z-index: 2000;
        transition: all 0.25s ease;
      }

      .admin-fab:hover {
        background: #1d4ed8;
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 12px 24px rgba(30, 64, 175, 0.45);
      }

      .admin-fab:active {
        transform: scale(0.95);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h1>
      </header>

      <div class="room-grid" id="roomContainer"></div>
      <hr style="margin: 60px 0" />

      <section class="history-section">
        <h2 class="history-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°</h2>

        <div id="adminControls" style="margin-bottom: 15px; display: none">
          <button
            onclick="clearHistory()"
            class="btn-cancel"
            style="width: auto"
          >
            üóë ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>
          <button
            onclick="resetAllRooms()"
            class="btn-cancel"
            style="width: auto"
          >
            ‚ôªÔ∏è ‡∏Ñ‡∏∑‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>
          <button onclick="logoutAdmin()" class="btn-close" style="width: auto">
            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </div>

        <div class="table-wrapper">
          <table class="history-table" id="historyTable">
            <thead>
              <tr>
                <th>‡∏´‡πâ‡∏≠‡∏á</th>
                <th>‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>

    <div class="modal-overlay" id="bookingModal">
      <div class="modal-box">
        <div class="modal-header">
          <h2 id="modalRoomName">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á...</h2>
          <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>
        </div>

        <div class="form-group">
          <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</label>
          <input type="text" id="inputName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ú‡∏ô‡∏Å IT" />
        </div>

        <label
          style="
            font-weight: 500;
            color: #334155;
            margin-bottom: 8px;
            display: block;
          "
          >‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 14 ‡∏ß‡∏±‡∏ô)</label
        >
        <div class="calendar-wrapper">
          <div class="calendar-header">
            <button class="cal-nav-btn" onclick="changeMonth(-1)">
              &#10094;
            </button>
            <span id="monthYearLabel">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2569</span>
            <button class="cal-nav-btn" onclick="changeMonth(1)">
              &#10095;
            </button>
          </div>
          <div class="calendar-days-header">
            <div>‡∏≠‡∏≤</div>
            <div>‡∏à</div>
            <div>‡∏≠</div>
            <div>‡∏û</div>
            <div>‡∏û‡∏§</div>
            <div>‡∏®</div>
            <div>‡∏™</div>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
        </div>
        <input type="hidden" id="selectedDateValue" />

        <div class="form-group">
          <label>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÄ‡∏£‡∏¥‡πà‡∏° - ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î)</label>
          <div class="time-range-group">
            <select
              id="startTime"
              class="time-select"
              onchange="updateEndTimeSelect()"
            >
              <option value="" disabled selected>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</option>
            </select>
            <span>‡∏ñ‡∏∂‡∏á</span>
            <select id="endTime" class="time-select">
              <option value="" disabled selected>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</option>
            </select>
          </div>
        </div>

        <div class="modal-actions">
          <button class="btn-close" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button class="btn-confirm" onclick="confirmBooking()">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
          </button>
        </div>
      </div>
    </div>

    <div class="modal-overlay" id="adminModal">
      <div class="modal-box">
        <div class="modal-header">
          <h2>Admin Login</h2>
          <p>‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</p>
        </div>

        <div class="form-group">
          <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input
            type="password"
            id="adminPassword"
            placeholder="Admin Password"
          />
        </div>

        <div class="modal-actions">
          <button class="btn-close" onclick="closeAdminLogin()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button class="btn-confirm" onclick="loginAdmin()">
            ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
          </button>
        </div>
      </div>
    </div>

    <script>
      // --- Data ---
      const defaultRooms = [
        {
          id: 1,
          name: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 1",
          capacity: 12,
          status: "available",
          user: "",
          date: "",
          time: "",
        },
        {
          id: 2,
          name: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 2",
          capacity: 6,
          status: "available",
          user: "",
          date: "",
          time: "",
        },
        {
          id: 3,
          name: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 3",
          capacity: 4,
          status: "available",
          user: "",
          date: "",
          time: "",
        },
        {
          id: 4,
          name: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 4",
          capacity: 30,
          status: "available",
          user: "",
          date: "",
          time: "",
        },
        {
          id: 5,
          name: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 5",
          capacity: 2,
          status: "available",
          user: "",
          date: "",
          time: "",
        },
        {
          id: 6,
          name: "‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° 6",
          capacity: 20,
          status: "available",
          user: "",
          date: "",
          time: "",
        },
      ];

      let rooms =
        JSON.parse(localStorage.getItem("meetingRooms")) || defaultRooms;

      // Validate Data Integrity
      if (rooms.length < 6 || !rooms[0].hasOwnProperty("date")) {
        rooms = defaultRooms;
        localStorage.removeItem("meetingRooms");
      }

      let bookingHistory =
        JSON.parse(localStorage.getItem("bookingHistory")) || [];
      let currentBookingRoomId = null;

      // --- Admin Config ---
      const ADMIN_PASSWORD = "123";
      let isAdmin = localStorage.getItem("isAdmin") === "true";

      // --- Calendar State ---
      let currentCalDate = new Date();
      let selectedDateObj = null;
      const today = new Date();
      today.setHours(0, 0, 0, 0);
    

      const maxBookingDate = new Date(today);
      maxBookingDate.setDate(today.getDate() + 14);

      // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÑ‡∏î‡πâ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
    const minMonth = new Date(today.getFullYear(), today.getMonth(), 1);
    const maxMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);

      // --- Time Configuration ---
      const startOfficeHour = 8;
      const endOfficeHour = 20;

      function populateStartTimeSelect() {
        const startSelect = document.getElementById("startTime");
        startSelect.innerHTML =
          '<option value="" disabled selected>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</option>';
        for (let h = startOfficeHour; h < endOfficeHour; h++) {
          const timeStr = `${h.toString().padStart(2, "0")}:00`;
          startSelect.innerHTML += `<option value="${timeStr}">${timeStr} ‡∏ô.</option>`;
        }
      }

      function updateEndTimeSelect() {
        const startSelect = document.getElementById("startTime");
        const endSelect = document.getElementById("endTime");
        const selectedStart = startSelect.value;
        endSelect.innerHTML =
          '<option value="" disabled selected>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</option>';

        if (!selectedStart) return;

        const startHourInt = parseInt(selectedStart.split(":")[0]);
        for (let h = startHourInt + 1; h <= endOfficeHour; h++) {
          const timeStr = `${h.toString().padStart(2, "0")}:00`;
          endSelect.innerHTML += `<option value="${timeStr}">${timeStr} ‡∏ô.</option>`;
        }
      }

      populateStartTimeSelect();

      // --- Render Rooms ---
      function renderRooms() {
        const container = document.getElementById("roomContainer");
        container.innerHTML = "";

        rooms.forEach((room) => {
          const isAvailable = room.status === "available";
          const card = document.createElement("div");
          card.className = `room-card ${room.status}`;

          let displayDate = room.date;
          if (room.date) {
            const d = new Date(room.date);
            displayDate = d.toLocaleDateString("th-TH", {
              day: "numeric",
              month: "short",
              year: "numeric",
            });
          }

          card.innerHTML = `
                <div>
                    <div class="badge">${isAvailable ? "‚óè ‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "‚óè ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á"}</div>
                    <h2 style="margin: 0 0 5px 0; font-size: 1.5rem;">${room.name}</h2>
                    <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 20px;">
                        <span style="font-size:1.2rem">üë•</span> ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: ${room.capacity} ‡∏ó‡πà‡∏≤‡∏ô
                    </p>
                    
                    ${
                      !isAvailable
                        ? `
                        <div class="info-box">
                            <strong>‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á:</strong> ${room.user}<br>
                            <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${displayDate}<br>
                            <strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${room.time} ‡∏ô.
                        </div>
                    `
                        : ""
                    }
                </div>

                ${
                  isAvailable
                    ? `
                    <button class="btn-book" onclick="openModal(${room.id})">‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</button>
                `
                    : `
                    <button class="btn-cancel" onclick="cancelBooking(${room.id})">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡∏Ñ‡∏∑‡∏ô‡∏´‡πâ‡∏≠‡∏á</button>
                `
                }
            `;
          container.appendChild(card);
        });
        localStorage.setItem("meetingRooms", JSON.stringify(rooms));
      }

      // --- Calendar Logic ---
      function renderCalendar() {
        const year = currentCalDate.getFullYear();
        const month = currentCalDate.getMonth();
        const monthsTH = [
          "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°",
          "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå",
          "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°",
          "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
          "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°",
          "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
          "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°",
          "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°",
          "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô",
          "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°",
          "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô",
          "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°",
        ];

        document.getElementById("monthYearLabel").innerText =
          `${monthsTH[month]} ${year + 543}`;

        const grid = document.getElementById("calendarGrid");
        grid.innerHTML = "";

        const firstDayIndex = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        for (let i = 0; i < firstDayIndex; i++) {
          const emptyCell = document.createElement("div");
          grid.appendChild(emptyCell);
        }

        for (let i = 1; i <= daysInMonth; i++) {
          const dateEl = document.createElement("div");
          dateEl.innerText = i;
          dateEl.className = "cal-date";

          const thisDate = new Date(year, month, i);
          thisDate.setHours(0, 0, 0, 0);

          if (thisDate.getTime() === today.getTime()) {
            dateEl.classList.add("today");
          }

          if (
            selectedDateObj &&
            thisDate.getTime() === selectedDateObj.getTime()
          ) {
            dateEl.classList.add("selected");
          }

          if (thisDate < today || thisDate > maxBookingDate) {
            dateEl.classList.add("disabled");
          } else {
            dateEl.onclick = () => selectDate(thisDate);
          }

          grid.appendChild(dateEl);
        }
        const prevBtn = document.querySelector(".cal-nav-btn:first-child");
const nextBtn = document.querySelector(".cal-nav-btn:last-child");

prevBtn.disabled =
  currentCalDate.getFullYear() === minMonth.getFullYear() &&
  currentCalDate.getMonth() === minMonth.getMonth();

nextBtn.disabled =
  currentCalDate.getFullYear() === maxMonth.getFullYear() &&
  currentCalDate.getMonth() === maxMonth.getMonth();

prevBtn.style.opacity = prevBtn.disabled ? "0.3" : "1";
nextBtn.style.opacity = nextBtn.disabled ? "0.3" : "1";

      }

      function changeMonth(step) {
  const newDate = new Date(
    currentCalDate.getFullYear(),
    currentCalDate.getMonth() + step,
    1
  );

  // ‚ùå ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô
  if (newDate < minMonth || newDate > maxMonth) {
    return;
  }

  currentCalDate = newDate;
  renderCalendar();
}


      function selectDate(date) {
        selectedDateObj = date;
        const offset = date.getTimezoneOffset() * 60000;
        const localISOTime = new Date(date - offset).toISOString().slice(0, 10);
        document.getElementById("selectedDateValue").value = localISOTime;
        renderCalendar();
      }

      // --- Admin Logic ---
      function openAdminLogin() {
        document.getElementById("adminModal").style.display = "flex";
      }

      function closeAdminLogin() {
        document.getElementById("adminModal").style.display = "none";
      }

      function loginAdmin() {
        const pass = document.getElementById("adminPassword").value;
        if (pass === ADMIN_PASSWORD) {
          isAdmin = true;
          localStorage.setItem("isAdmin", "true");
          closeAdminLogin();
          alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
          renderHistory();
        } else {
          alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        }
      }

      function logoutAdmin() {
        isAdmin = false;
        localStorage.removeItem("isAdmin");
        renderHistory();
      }

      // --- Booking Logic ---
      function openModal(id) {
        const room = rooms.find((r) => r.id === id);
        currentBookingRoomId = id;

        document.getElementById("modalRoomName").innerText = room.name;
        document.getElementById("inputName").value = "";
        document.getElementById("startTime").selectedIndex = 0;

        const endSelect = document.getElementById("endTime");
        endSelect.innerHTML =
          '<option value="" disabled selected>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</option>';
        document.getElementById("selectedDateValue").value = "";

        selectedDateObj = null;
        currentCalDate = new Date();
        renderCalendar();

        document.getElementById("bookingModal").style.display = "flex";
      }

      function closeModal() {
        document.getElementById("bookingModal").style.display = "none";
        currentBookingRoomId = null;
      }

      function confirmBooking() {
        if (!currentBookingRoomId) return;

        const name = document.getElementById("inputName").value;
        const dateStr = document.getElementById("selectedDateValue").value;
        const start = document.getElementById("startTime").value;
        const end = document.getElementById("endTime").value;

        if (!name || !dateStr || !start || !end) {
          alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô (‡∏ä‡∏∑‡πà‡∏≠, ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤)");
          return;
        }

        const index = rooms.findIndex((r) => r.id === currentBookingRoomId);
        rooms[index].status = "busy";
        rooms[index].user = name;
        rooms[index].date = dateStr;
        rooms[index].time = `${start} - ${end}`;

        bookingHistory.push({
          roomId: rooms[index].id,
          roomName: rooms[index].name,
          user: name,
          date: dateStr,
          time: `${start} - ${end}`,
          createdAt: new Date().toLocaleString("th-TH"),
        });

        localStorage.setItem("bookingHistory", JSON.stringify(bookingHistory));
        renderRooms();
        renderHistory();
        closeModal();
      }

      function cancelBooking(id) {
        if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?")) return;

        const index = rooms.findIndex((r) => r.id === id);
        const room = rooms[index];

        // ‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
        // ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏Å‡πá‡∏ö History ‡πÑ‡∏ß‡πâ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏à‡∏≤‡∏Å bookingHistory
        // ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏∑‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏â‡∏¢‡πÜ

        room.status = "available";
        room.user = "";
        room.date = "";
        room.time = "";

        localStorage.setItem("meetingRooms", JSON.stringify(rooms));
        renderRooms();
        // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö history ‡∏î‡πâ‡∏ß‡∏¢ ‡∏Å‡πá‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏õ‡∏Å‡∏ï‡∏¥ History ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏î‡∏π‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
        // renderHistory();
      }

      // --- Admin Actions on History ---

      // ‚ú® 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡πÄ‡∏ä‡πá‡∏Ñ Data
      function deleteHistoryByData(roomId, user, date, time) {
        if (!confirm("‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) return;

        bookingHistory = bookingHistory.filter(
          (h) =>
            !(
              h.roomId == roomId &&
              h.user === user &&
              h.date === date &&
              h.time === time
            ),
        );

        localStorage.setItem("bookingHistory", JSON.stringify(bookingHistory));
        renderHistory();
      }

      function clearHistory() {
        if (!confirm("‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
        bookingHistory = [];
        localStorage.setItem("bookingHistory", "[]");
        renderHistory();
      }

      function resetAllRooms() {
        if (!confirm("‡∏Ñ‡∏∑‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á?")) return;
        rooms.forEach((r) => {
          r.status = "available";
          r.user = "";
          r.date = "";
          r.time = "";
        });
        localStorage.setItem("meetingRooms", JSON.stringify(rooms));
        renderRooms();
      }

      // --- Render History ---
      function renderHistory() {
        const tbody = document.querySelector("#historyTable tbody");
        tbody.innerHTML = "";

        if (bookingHistory.length === 0) {
          tbody.innerHTML = `
            <tr>
                <td colspan="5" style="text-align:center; padding:20px; color:#64748b;">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                </td>
            </tr>
        `;
          document.getElementById("adminControls").style.display = isAdmin
            ? "block"
            : "none";
          return;
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤ (Reverse)
        const reversedHistory = bookingHistory.slice().reverse();

        reversedHistory.forEach((h) => {
          const d = new Date(h.date);
          const displayDate = d.toLocaleDateString("th-TH", {
            day: "numeric",
            month: "short",
            year: "numeric",
          });

          // ‚ú® 2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å deleteHistoryByData
          tbody.innerHTML += `
            <tr>
              <td>${h.roomName}</td>
              <td>${h.user}</td>
              <td>${displayDate}</td>
              <td>${h.time} ‡∏ô.</td>
              <td>
                ${h.createdAt}
                ${
                  isAdmin
                    ? `<br><button 
                        onclick="deleteHistoryByData('${h.roomId}', '${h.user}', '${h.date}', '${h.time}')"
                        style="margin-top:5px;font-size:0.8rem;color:#dc2626;border:none;background:none;cursor:pointer;width:auto;">
                        ‡∏•‡∏ö
                      </button>`
                    : ""
                }
              </td>
            </tr>
          `;
        });

        // ‚ú® 4. ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Admin Panel
        document.getElementById("adminControls").style.display = isAdmin
          ? "block"
          : "none";
      }

      // Event Listeners
      document
        .getElementById("bookingModal")
        .addEventListener("click", function (e) {
          if (e.target === this) closeModal();
        });

      // Init
      renderRooms();
      renderHistory();
    </script>
    <button class="admin-fab" onclick="openAdminLogin()" title="Admin">
      üë®üèª‚Äçüíº
    </button>
  </body>
</html>
